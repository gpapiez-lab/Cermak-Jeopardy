<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Jeopardy + Firebase Buzzer</title>
  <style>
    :root{--bg:#0b1020;--panel:#111a33;--tile:#17306e;--tile2:#10265c;--accent:#f7c948;--text:#e9eefc;--muted:#a9b5d6;--danger:#ff5d5d;--good:#46d39a;--border:rgba(255,255,255,.12);--shadow:0 10px 30px rgba(0,0,0,.35);--radius:16px;--font:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;}
    *{box-sizing:border-box}
    body{margin:0;font-family:var(--font);background:radial-gradient(1200px 800px at 20% 10%, #1a2a66 0%, var(--bg) 50%, #070a14 100%);color:var(--text);min-height:100vh;padding:18px;}
    header{display:flex;align-items:center;justify-content:space-between;gap:12px;margin:0 auto 14px;max-width:1200px;}
    h1{font-size:20px;margin:0;letter-spacing:.5px}
    .sub{color:var(--muted);font-size:13px}
    .controls{display:flex;gap:10px;flex-wrap:wrap;justify-content:flex-end}
    button{background:linear-gradient(180deg,#1c2f72,#13265e);color:var(--text);border:1px solid var(--border);border-radius:999px;padding:10px 14px;cursor:pointer;box-shadow:var(--shadow);font-weight:600;}
    button:hover{filter:brightness(1.06)} button:active{transform:translateY(1px)}
    button.secondary{background:transparent;box-shadow:none}
    button.danger{background:linear-gradient(180deg,#7a1b1b,#4a0f0f)}
    button.good{background:linear-gradient(180deg,#146b4b,#0b3d2a)}
    main{max-width:1200px;margin:0 auto;display:grid;grid-template-columns:1fr;gap:14px;}
    .row2{display:grid;grid-template-columns:1.2fr .8fr;gap:14px}
    @media (max-width:980px){.row2{grid-template-columns:1fr}}
    .panel{background:rgba(17,26,51,.78);border:1px solid var(--border);border-radius:var(--radius);padding:12px;box-shadow:var(--shadow);}
    .scoreboard{display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap;}
    .teams{display:flex;gap:10px;flex-wrap:wrap}
    .team{background:rgba(255,255,255,.05);border:1px solid var(--border);border-radius:14px;padding:10px 12px;min-width:180px;}
    .team .name{display:flex;align-items:center;justify-content:space-between;gap:8px;font-weight:800}
    .team .score{font-size:20px;color:var(--accent)}
    .team .adj{display:flex;gap:8px;margin-top:10px;flex-wrap:wrap}
    .board{display:grid;gap:10px;background:rgba(17,26,51,.55);border:1px solid var(--border);border-radius:var(--radius);padding:12px;box-shadow:var(--shadow);overflow:auto;}
    .cell{border-radius:14px;border:1px solid var(--border);background:linear-gradient(180deg,var(--tile),var(--tile2));padding:10px;min-height:72px;display:flex;align-items:center;justify-content:center;text-align:center;user-select:none;position:relative;}
    .cell.category{background:linear-gradient(180deg,#2a3f8f,#1b2f74);font-weight:900;letter-spacing:.4px;text-transform:uppercase;font-size:13px;}
    .cell.question{cursor:pointer;font-weight:900;font-size:20px;color:var(--accent);}
    .cell.question.used{cursor:not-allowed;filter:grayscale(.9) brightness(.75);color:rgba(247,201,72,.35);}
    .badge{position:absolute;top:8px;right:8px;font-size:11px;color:#0b1020;background:var(--accent);padding:3px 8px;border-radius:999px;font-weight:900;}
    .pill{display:inline-flex;padding:8px 12px;border-radius:999px;border:1px solid var(--border);background:rgba(255,255,255,.05);font-weight:700;color:var(--muted);gap:8px;align-items:center;}
    .small{font-size:12px;color:var(--muted)}
    .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace}
    .overlay{position:fixed;inset:0;background:rgba(0,0,0,.55);display:none;align-items:center;justify-content:center;padding:18px;z-index:50;}
    .overlay.show{display:flex}
    .modal{width:min(820px,100%);background:rgba(17,26,51,.94);border:1px solid var(--border);border-radius:22px;box-shadow:var(--shadow);padding:16px;}
    .modal header{max-width:none;margin:0;padding:0 0 10px 0}
    .modal h2{margin:0;font-size:16px}
    .meta{color:var(--muted);font-size:13px}
    .prompt{margin:14px 0;font-size:28px;font-weight:900;line-height:1.15;text-align:center;padding:18px;border-radius:18px;border:1px solid var(--border);background:rgba(0,0,0,.18);}
    .reveal{margin:12px auto 0;max-width:740px;display:none;border-top:1px solid var(--border);padding-top:12px;}
    .reveal.show{display:block}
    .reveal .label{color:var(--muted);font-size:12px;text-transform:uppercase;letter-spacing:.4px}
    .reveal .answer{font-size:20px;font-weight:800;margin-top:6px}
    .actions{display:flex;gap:10px;flex-wrap:wrap;justify-content:space-between;margin-top:14px;}
    .actions .left,.actions .right{display:flex;gap:10px;flex-wrap:wrap}
    .final-grid{display:grid;gap:10px;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));}
    .final-card{background:rgba(255,255,255,.05);border:1px solid var(--border);border-radius:18px;padding:12px;}
    .final-card .tname{font-weight:900}
    .final-card .tscore{color:var(--accent);font-weight:900}
    .final-card label{display:block;color:var(--muted);font-size:12px;margin-top:10px}
    .final-card input{width:100%;background:rgba(0,0,0,.18);color:var(--text);border:1px solid var(--border);border-radius:12px;padding:10px 10px;margin-top:6px;}
  </style>
</head>
<body>
<header>
  <div>
    <h1 id="gameTitle">Jeopardy</h1>
    <div class="sub" id="gameSubtitle">Phones buzz in → host awards points.</div>
  </div>
  <div class="controls">
    <button class="secondary" id="btnToggleDD">Host: Show DD</button>
    <button id="btnFinal">Final Jeopardy</button>
    <button class="danger" id="btnReset">Reset Game</button>
  </div>
</header>

<main>
  <div class="row2">
    <section class="panel scoreboard" id="scoreboard"></section>

    <section class="panel">
      <div style="display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap">
        <div>
          <div style="font-weight:900">Firebase Buzzer</div>
          <div class="small">Send players the join link + room code.</div>
        </div>
        <div style="display:flex;gap:10px;flex-wrap:wrap;align-items:center">
          <span class="pill">Room: <span class="mono" id="roomCode">—</span></span>
          <button id="btnNewRoom">New Room</button>
          <button class="danger" id="btnResetBuzz" disabled>Reset Buzz</button>
        </div>
      </div>

      <div style="margin-top:12px">
        <div class="small">Join link:</div>
        <div class="mono" id="joinLink">—</div>
      </div>

      <div style="margin-top:12px;display:flex;gap:10px;flex-wrap:wrap;align-items:center">
        <span class="pill">Status: <span id="buzzStatus">—</span></span>
        <span class="pill">Winner: <span id="buzzWinner">—</span></span>
      </div>

      <div style="margin-top:12px">
        <div class="small">Players:</div>
        <div id="playerList">—</div>
      </div>
    </section>
  </div>

  <section class="board" id="board"></section>
</main>

<!-- Question Modal -->
<div class="overlay" id="qOverlay">
  <div class="modal">
    <header>
      <div>
        <h2 id="qTitle"></h2>
        <div class="meta" id="qMeta"></div>
      </div>
      <button class="secondary" id="btnCloseQ">Close</button>
    </header>

    <div class="prompt" id="qPrompt"></div>

    <div class="reveal" id="qReveal">
      <div class="label">Answer</div>
      <div class="answer" id="qAnswer"></div>
    </div>

    <div class="actions">
      <div class="left">
        <span class="pill" id="qValuePill"></span>
        <span class="pill" id="qDDPill" style="display:none">Daily Double</span>
      </div>
      <div class="right">
        <button id="btnReveal">Reveal Answer</button>
        <button class="good" id="btnCorrect">Correct (+)</button>
        <button class="danger" id="btnWrong">Wrong (-)</button>
      </div>
    </div>

    <div class="small" style="margin-top:10px">Select which team is answering:</div>
    <div class="teams" id="qTeams" style="margin-top:10px"></div>
  </div>
</div>

<!-- Final Jeopardy Modal -->
<div class="overlay" id="fOverlay">
  <div class="modal">
    <header>
      <div>
        <h2>Final Jeopardy</h2>
        <div class="meta" id="fMeta"></div>
      </div>
      <button class="secondary" id="btnCloseF">Close</button>
    </header>

    <div class="prompt" id="fPrompt"></div>

    <div class="final-grid" id="finalGrid"></div>

    <div class="reveal" id="fReveal">
      <div class="label">Answer</div>
      <div class="answer" id="fAnswer"></div>
    </div>

    <div class="actions">
      <div class="left"></div>
      <div class="right">
        <button id="btnRevealFinal">Reveal Answer</button>
        <button class="good" id="btnApplyFinal">Apply Wagers</button>
      </div>
    </div>

    <div class="small">Enter wagers, mark Correct/Wrong, then “Apply Wagers”.</div>
  </div>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";
  import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-auth.js";
  import {
    getFirestore, doc, setDoc, updateDoc, onSnapshot,
    serverTimestamp, collection, query, onSnapshot as onSnapQuery
  } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js";
try {
  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);
  await signInAnonymously(auth);
  // continue...
} catch (e) {
  alert("Firebase init failed: " + (e?.code || e?.message || e));
  throw e;
}

  // ✅ YOUR CONFIG
  const firebaseConfig = {
    apiKey: "AIzaSyAadTD1tOCnYrqOP43dpeQpPBzlqv-JdvE",
    authDomain: "jeopardy-5956d.firebaseapp.com",
    projectId: "jeopardy-5956d",
    storageBucket: "jeopardy-5956d.firebasestorage.app",
    messagingSenderId: "979136812527",
    appId: "1:979136812527:web:904c0fc6f773f20596921a"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);
  await signInAnonymously(auth);

  /** =========================
   *  EDIT GAME CONTENT HERE
   *  ========================= */
  const GAME = {
    title: "Jeopardy Quiz Night",
    subtitle: "Phones buzz in → host awards points.",
    teams: [],
    values: [100,200,300,400,500],
    categories: [
      { name:"Medicine", clues:[
        { q:"This vital sign is measured in mmHg.", a:"What is blood pressure?" },
        { q:"First-line med classes often used for essential HTN.", a:"What are thiazides / ACEi/ARB / CCB (any acceptable)?" },
        { q:"ECG finding classically associated with hyperkalemia.", a:"What are peaked T waves?" },
        { q:"Score estimating stroke risk in atrial fibrillation.", a:"What is CHA₂DS₂-VASc?" },
        { q:"Daily Double: Antibiotic class of vancomycin.", a:"What is a glycopeptide?", dd:true },
      ]},
      { name:"Movies", clues:[
        { q:"He directed 'Jaws' and 'E.T.'", a:"Who is Steven Spielberg?" },
        { q:"1999 film with the 'first rule' of an underground club.", a:"What is Fight Club?" },
        { q:"Fictional African nation in Black Panther.", a:"What is Wakanda?" },
        { q:"Actor who played Joker in The Dark Knight.", a:"Who is Heath Ledger?" },
        { q:"Daily Double: 'I’ll be back' character.", a:"Who is the Terminator (T-800)?", dd:true },
      ]},
      { name:"Science", clues:[
        { q:"Force equals mass times…", a:"What is acceleration?" },
        { q:"Plants turning light into chemical energy.", a:"What is photosynthesis?" },
        { q:"Most abundant gas in Earth’s atmosphere.", a:"What is nitrogen?" },
        { q:"Negatively charged particle.", a:"What is an electron?" },
        { q:"Daily Double: SI unit of current.", a:"What is the ampere?", dd:true },
      ]},
      { name:"Food & Drink", clues:[
        { q:"Tequila + lime + triple sec cocktail.", a:"What is a Margarita?" },
        { q:"Garlic + tomatoes + basil sauce.", a:"What is marinara?" },
        { q:"Agave spirit; smoky versions often from Oaxaca.", a:"What is mezcal?" },
        { q:"Low-temp vacuum bag cooking method.", a:"What is sous vide?" },
        { q:"Daily Double: Polish dumplings.", a:"What are pierogi?", dd:true },
      ]},
      { name:"Poland", clues:[
        { q:"Capital of Poland.", a:"What is Warsaw (Warszawa)?" },
        { q:"Region known for Góralski culture.", a:"What is Podhale / Tatra region?" },
        { q:"Famous salt mine near Kraków.", a:"What is Wieliczka?" },
        { q:"Poland’s currency.", a:"What is the złoty (PLN)?" },
        { q:"Daily Double: Sea bordering northern Poland.", a:"What is the Baltic Sea?", dd:true },
      ]},
    ],
    final: { category:"Final Jeopardy", q:"This US city is known as the 'Windy City'.", a:"What is Chicago?" }
  };

  function setupTeams(){
    let count;
    do { count = parseInt(prompt("How many teams?", "4") || "", 10); }
    while(!Number.isInteger(count) || count < 1);

    const teams=[];
    for(let i=1;i<=count;i++){
      let name="";
      while(!name) name = (prompt(`Enter name for Team ${i}:`, `Team ${i}`) || "").trim();
      teams.push(name.slice(0,24));
    }
    GAME.teams = teams;
  }

  /** ===== BUZZER ===== */
  const roomCodeEl = document.getElementById("roomCode");
  const joinLinkEl = document.getElementById("joinLink");
  const buzzStatusEl = document.getElementById("buzzStatus");
  const buzzWinnerEl = document.getElementById("buzzWinner");
  const playerListEl = document.getElementById("playerList");
  const btnNewRoom = document.getElementById("btnNewRoom");
  const btnResetBuzz = document.getElementById("btnResetBuzz");

  let roomCode = null;
  let unsubRoom = null;
  let unsubPlayers = null;

  function randCode(){ return String(Math.floor(1000 + Math.random()*9000)); }

  // ✅ GitHub Pages-safe: builds correct URL even with /repo-name/
  function playerJoinUrl(){
    return new URL("player.html", window.location.href).toString();
  }

  function setBuzzerUI({locked, winnerName, players}){
    if (locked !== undefined) buzzStatusEl.textContent = roomCode ? (locked ? "LOCKED" : "Ready") : "—";
    if (winnerName !== undefined) buzzWinnerEl.textContent = winnerName || "—";
    if (players !== undefined) playerListEl.textContent = players.length ? players.join(", ") : "—";
  }

  async function createRoom(){
    roomCode = randCode();
    roomCodeEl.textContent = roomCode;
    joinLinkEl.textContent = `${playerJoinUrl()}  (Room: ${roomCode})`;
    btnResetBuzz.disabled = false;

    const ref = doc(db, "rooms", roomCode);
    await setDoc(ref, { createdAt: serverTimestamp(), locked:false, winnerName:null, winnerUid:null });

    watchRoom(roomCode);
    setBuzzerUI({locked:false, winnerName:null, players:[]});
  }

  function watchRoom(code){
    unsubRoom?.(); unsubPlayers?.();

    unsubRoom = onSnapshot(doc(db,"rooms",code), (snap)=>{
      if(!snap.exists()) return;
      const d = snap.data();
      setBuzzerUI({ locked: !!d.locked, winnerName: d.winnerName ?? null });
    });

    unsubPlayers = onSnapQu
